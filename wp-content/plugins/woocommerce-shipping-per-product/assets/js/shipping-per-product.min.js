jQuery(function(o){var e=!1;o(document.body).on("keyup keydown",function(t){e=t.ctrlKey||t.metaKey});function i(){o('[name^="per_product_order"]').each(function(t,e){o(e).val(t)})}o("body").on("init_shipping_per_product",function(){o("input#_per_product_shipping").change(),o("input.variable_is_virtual").change(),o(".enable_per_product_shipping").change(),o("body").trigger("init_shipping_per_product_sortable")}).on("init_shipping_per_product_sortable",function(){o(".per_product_shipping_rules tbody").sortable({items:"tr",cursor:"move",axis:"y",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){i(),e.item.removeAttr("style")}})}).on("change","input#_per_product_shipping",function(){o("input#_per_product_shipping").is(":checked")?o(this).closest("div").find(".per_product_shipping_rules").show():o(this).closest("div").find(".per_product_shipping_rules").hide()}).on("change","input.variable_is_virtual",function(){o(this).is(":checked")?o(this).closest(".woocommerce_variation").find(".enable_per_product_shipping").parent("label").hide():o(this).closest(".woocommerce_variation").find(".enable_per_product_shipping").parent("label").show()}),o(".woocommerce_variations").on("change",".enable_per_product_shipping",function(){o(this).is(":checked")?o(this).closest(".woocommerce_variation").find(".per_product_shipping_rules").show():o(this).closest(".woocommerce_variation").find(".per_product_shipping_rules").hide()}).on("woocommerce_variations_added woocommerce_variations_loaded",function(){o("body").trigger("init_shipping_per_product")}),o("#woocommerce-product-data").on("woocommerce_variations_added woocommerce_variations_loaded",function(){o("body").trigger("init_shipping_per_product")}),o("#woocommerce-product-data").on("focus",".per_product_shipping_rules input",function(){e||o(".per_product_shipping_rules tr").removeClass("current"),o(this).closest("tr").addClass("current")}).on("click",".per_product_shipping_rules input",function(){return o(this).focus(),!0}).on("click",".per_product_shipping_rules .remove",function(){var t=o(this).closest(".per_product_shipping_rules").find("tbody");return t.find("tr.current").length?(t.find("tr.current").find("input").val(""),t.find("tr.current").hide()):alert(wc_shipping_per_product_params.i18n_no_row_selected),!1}).on("click",".per_product_shipping_rules .insert",function(){var t=o(this).closest(".per_product_shipping_rules").find("tbody"),e=o(this).data("postid"),r='<tr>\t\t\t\t<td class="sort">&nbsp;<input type="hidden" value="" name="per_product_order['+e+'][new][]" /></td>\t\t\t\t<td class="country"><input type="text" value="" maxlength="2" placeholder="*" name="per_product_country['+e+'][new][]" /></td>\t\t\t\t<td class="state"><input type="text" value="" maxlength="2" placeholder="*" name="per_product_state['+e+'][new][]" /></td>\t\t\t\t<td class="postcode"><input type="text" value="" placeholder="*" name="per_product_postcode['+e+'][new][]" /></td>\t\t\t\t<td class="cost"><input type="text" class="wc_input_price input-text regular-input" value="0.00" placeholder="0.00" name="per_product_cost['+e+'][new][]" /></td>\t\t\t\t<td class="item_cost"><input type="text" class="wc_input_price input-text regular-input" value="0.00" placeholder="0.00" name="per_product_item_cost['+e+'][new][]" /></td>\t\t\t</tr>';return t.find("tr.current").length?t.find("tr.current").last().after(r):t.append(r),i(),!1}).on("click",".per_product_shipping_rules .export",function(t){t.preventDefault();var r=o(this),p=o(this).data("postid");r.attr("disabled",!0),o.ajax({url:ajaxurl,method:"post",data:{action:"wc_shipping_per_product_export_rules",product_id:p},success:function(t){if(t.success){var i=wc_shipping_per_product_params.i18n_product_id+","+wc_shipping_per_product_params.i18n_country_code+","+wc_shipping_per_product_params.i18n_state+","+wc_shipping_per_product_params.i18n_postcode+","+wc_shipping_per_product_params.i18n_cost+","+wc_shipping_per_product_params.i18n_item_cost+"\n";o.each(t.rules,function(t,e){var r;r=[e.product_id,e.rule_country||"*",e.rule_state||"*",e.rule_postcode||"*",e.rule_cost||"0.00",e.rule_item_cost||"0.00"].join(),i=i+r+"\n"});var e=document.createElement("a");return e.href=URL.createObjectURL(new Blob([i])),e.download="per-product-rates-"+p+".csv",document.body.appendChild(e),e.click(),document.body.removeChild(e),r.attr("disabled",!1),!0}}})}),o("body").trigger("init_shipping_per_product")});
