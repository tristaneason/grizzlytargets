jQuery(document).ready(function(){jQuery(document).on("opened",".remodal.custom-modal-editor",function(){var e=window.vgseWCAttsCurrent;if(!e||"vgse_save_download_files"!==e.modalSettings.edit_modal_save_action)return!0;jQuery(".remodal.custom-modal-editor .vgse-copy-files-from-product-wrapper").remove()}),jQuery(document).on("opened",".remodal.custom-modal-editor",function(){var t=window.vgseWCAttsCurrent;if(!t||"vgse_save_download_files"!==t.modalSettings.edit_modal_save_action)return!0;setTimeout(function(){$modal=jQuery(".remodal.custom-modal-editor");var e=$modal.find(".vgse-copy-files-from-product");$modal.find(".vgse-copy-files-from-product-trigger").click(function(){if(!e.val())return!0;loading_ajax({estado:!0}),jQuery.get(ajaxurl,{nonce:e.data("nonce"),product_id:e.val(),action:"vgse_wc_get_downloadable_files"},function(e){e.success?initHandsontableForPopup(e.data,t.modalSettings):notification({mensaje:e.data.message,tipo:"error",tiempo:3e4}),loading_ajax({estado:!1})})})},400)})}),jQuery(document).ready(function(){jQuery("body").on("change",'input[name="copy_individual_variations"]',function(e){var t=jQuery(".vgse-copy-variation-from-product").val();jQuery(this).is(":checked")&&t&&(loading_ajax(!0),jQuery(".individual-variations-select").empty(),jQuery(".individual-variations-selector-wrapper").show(),jQuery.get(ajaxurl,{action:"vgse_get_product_variations",nonce:jQuery(".remodal-bg").data("nonce"),product_id:t},function(e){loading_ajax(!1),e.success?e.data.length?e.data.forEach(function(e){jQuery(".individual-variations-select").append('<option value="'+e.ID+'">'+e.post_title+"</option>")}):alert(vgse_editor_settings.texts.product_without_variations):alert(e.data.message),vgseInitSelect2(jQuery(".individual-variations-select"))}))}),jQuery("body").on("change",".vgse-copy-variation-from-product",function(e){var t=jQuery(this).val(),a=jQuery(".link-variations-attributes, .link-variations-number");t?(a.parents("li").hide(),jQuery(".individual-variations-wrapper").show()):(a.parents("li").show(),jQuery(".individual-variations-wrapper").hide())}),jQuery("body").on("change",".link-variations-attributes",function(e){var t=jQuery(".link-variations-number");jQuery(this).is(":checked")?t.parents("li").hide():t.parents("li").show()}),jQuery("body").on("submit",".create-variation-modal form",function(e){var r=jQuery(this);if("search"===r.find('select[name="vgse_variation_manager_source"]').val()&&!r.find('input[name="use_search_query"]:checked').length)return r.find('input[name="use_search_query"]').css("border","1px solid red"),!0;r.find('input[name="use_search_query"]:checked').length&&"function"==typeof beGetRowsFilters&&r.find('input[name="filters"]').val(beGetRowsFilters());var t=r.find("input,select,textarea").filter(function(){return jQuery(this).parents(".vgse-variations-tool").length&&jQuery(this).parents(".vgse-variations-tool").is(":visible")||!jQuery(this).parents(".vgse-variations-tool").length}).serializeArray();if(r.find('input[name="use_search_query"]:checked').length){loading_ajax({estado:!1});var i=jQuery(".vgse-variations-tool .response");i.before('<div id="be-variations-nanobar-container" />');var a={classname:"be-progress-bar",target:document.getElementById("be-variations-nanobar-container")},n=new Nanobar(a);n.go(1);var s=jQuery(".be-total-rows").text().match(/\d+/g).map(Number),d=vgse_editor_settings.save_posts_per_page/2;d<1&&(d=1),beAjaxLoop({totalCalls:Math.ceil(s/parseInt(d)),url:r.attr("action"),method:r.attr("method"),data:t,onSuccess:function(e,t){if(loading_ajax({estado:!1}),!0===e.success||e.data||(e={data:{message:vgse_editor_settings.texts.http_error_try_now},success:!1}),!e.success)return jQuery(i).append("<p>"+e.data.message+"</p>"),confirm(e.data.message)?(t.current=0,i.scrollTop(i[0].scrollHeight),!0):(jQuery(i).append(vgse_editor_settings.texts.saving_stop_error),i.scrollTop(i[0].scrollHeight),!1);e.data.deleted.length&&vgseRemoveRowFromSheetByID(e.data.deleted),n.go(t.current/t.totalCalls*100);var a=parseInt(d)*t.current>s?s:parseInt(d)*t.current,o=(o=vgse_editor_settings.texts.paged_batch_saved.replace("{updated}",a)).replace("{total}",s);return jQuery(i).empty().append("<p>"+o+"</p>"),t.current===t.totalCalls&&(jQuery(i).append("<p>"+vgse_editor_settings.texts.everything_saved+"</p>"),loading_ajax({estado:!1}),notification({mensaje:vgse_editor_settings.texts.everything_saved}),i.find(".remodal-cancel").removeClass("hidden"),r.find("#be-variations-nanobar-container").remove()),setTimeout(function(){i.scrollTop(i[0].scrollHeight)},600),!0}})}else loading_ajax({estado:!0}),jQuery.ajax({url:r.attr("action"),method:r.attr("method"),data:t}).done(function(e){loading_ajax({estado:!1}),e.success?(1<e.data.data.length&&vgAddRowsToSheet(e.data.data,"prepend",!0),e.data.deleted.length&&vgseRemoveRowFromSheetByID(e.data.deleted),notification({mensaje:e.data.message}),jQuery(window).scrollTop(jQuery(".be-spreadsheet-wrapper").offset().top-jQuery("#vg-header-toolbar").height()-20)):notification({mensaje:e.data.message,tipo:"error",tiempo:6e4}),jQuery(".create-variation-modal").remodal().close()});return!1})}),jQuery(document).ready(function(){jQuery(".vgse-current-filters").on("click",".button",function(e){"wc_display_variations"!==jQuery(this).data("filter-key")&&!jQuery(this).hasClass("remove-all-filters")||jQuery("#display-variations").prop("checked",!jQuery("#display-variations").prop("checked"))}),jQuery('.vgse-current-filters .button[data-filter-key="wc_display_variations"]').length&&jQuery("#display-variations").prop("checked",!0),jQuery("#display-variations").click(function(e){var t=jQuery(this);if(beGetModifiedItems().length){if(t.is(":checked"))var a=vgse_wc_attr_data.texts.variations_on_reload_needed;else a=vgse_wc_attr_data.texts.variations_off_reload_needed;if(!confirm(a))return t.prop("checked",!1),!0}t.is(":checked")&&jQuery("body").addClass("vg-variations-enabled");var o={wc_display_variations:t.is(":checked")?"yes":""};beAddRowsFilter(o),vgseReloadSpreadsheet()})}),jQuery(document).ready(function(){jQuery("body").on("vgSheetEditor:beforeRowsInsert",function(e,t){if(void 0===t.data.total_inventory_price||void 0===t.data.total_inventory_price)return!0;jQuery("#responseConsole .wc-inventory-totals").length||jQuery("#responseConsole").append('<span class="wc-inventory-totals"></span>'),jQuery("#responseConsole .wc-inventory-totals").html(". <b>Inventory:</b> "+t.data.total_inventory_units+" units ("+t.data.total_inventory_price+")")})}),jQuery(document).ready(function(){var r=jQuery(".vgse-variations-tool-selector");r.click(function(e){e.preventDefault();var t=jQuery(this).data("target");jQuery(".vgse-variations-tool").hide(),r.removeClass("active"),jQuery(this).addClass("active");var a=jQuery(t);a.show(),a.find('[name="vgse_variation_manager_source"]').length||a.find(".individual-product-selector").show();var o=a.find("select.select2");if(o.select2)try{o.select2("destroy")}catch(e){}vgseInitSelect2(o.filter(function(){return jQuery(this).is(":visible")}))}),jQuery('[name="vgse_variation_manager_source"]').change(function(e){var t=jQuery(this).parents(".vgse-variations-tool"),a=jQuery(this).val();t.find(".use-search-query-container").hide(),"search"===a?(t.find(".use-search-query-container").css("display","block"),t.find(".individual-product-selector ~ .select2").hide(),window.vgseBackToVariationsTool=!0,jQuery('[name="run_filters"]').first().click()):(t.find(".individual-product-selector").show(),t.find(".individual-product-selector ~ .select2").show());var o=t.find("select.select2");vgseInitSelect2(o.filter(function(){return jQuery(this).is(":visible")}))}),jQuery(document).on("closed",'[data-remodal-id="modal-filters"]',function(){void 0!==window.vgseBackToVariationsTool&&window.vgseBackToVariationsTool&&(window.vgseBackToVariationsTool=!1,jQuery('[data-remodal-target="create-variation-modal"]').first().click())}),jQuery(".vgse-variations-tool .show-advanced-options").change(function(){jQuery(this).is(":checked")?jQuery(".vgse-variations-tool .advanced-options").show():jQuery(".vgse-variations-tool .advanced-options").hide()}),jQuery(document).on("closed",'[data-remodal-id="create-variation-modal"]',function(){jQuery('[data-remodal-id="create-variation-modal"]').find(".response").empty()})}),jQuery(document).ready(function(){if("undefined"==typeof hot||!jQuery(".create_variation-container").length)return!0;var e=hot.getSettings().contextMenu;void 0===e.items&&(e.items={}),e.items.wc_separator1={name:"---------"},e.items.wpse_create_variations={name:vgse_editor_settings.texts.create_variations,callback:function(e,t,a){if(beGetModifiedItems().length)alert(vgse_editor_settings.texts.save_changes_before_we_reload);else{var o=parseInt(hot.getDataAtRowProp(t[0].start.row,"ID")),r=hot.getDataAtRowProp(t[0].start.row,"post_title"),i=jQuery(".create-variation-modal .vgse-create-variations .individual-product-selector"),n="product--"+o;i.append('<option value="'+n+'">'+r+"</option>"),i.val(n).trigger("change"),jQuery(".create_variation-container  button").click(),setTimeout(function(){jQuery('.create-variation-modal .vgse-variations-tool-selector[data-target=".vgse-create-variations"]').click()},800)}}},e.items.wpse_copy_variations={name:vgse_editor_settings.texts.copy_variations,callback:function(e,t,a){if(beGetModifiedItems().length)alert(vgse_editor_settings.texts.save_changes_before_we_reload);else{var o=parseInt(hot.getDataAtRowProp(t[0].start.row,"ID")),r=hot.getDataAtRowProp(t[0].start.row,"post_title"),i=jQuery(".create-variation-modal .vgse-copy-variations .vgse-copy-variation-from-product"),n="product--"+o;i.append('<option value="'+n+'">'+r+"</option>"),i.val(n).trigger("change"),jQuery(".create_variation-container  button").click(),setTimeout(function(){jQuery('.create-variation-modal .vgse-variations-tool-selector[data-target=".vgse-copy-variations"]').click()},800)}}},hot.updateSettings({contextMenu:e})});